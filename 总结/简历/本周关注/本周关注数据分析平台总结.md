# ç­–ç•¥æ¨¡å¼ + å·¥å‚æ¨¡å¼åœ¨HRæœ¬å‘¨å…³æ³¨ç³»ç»Ÿä¸­çš„å·§å¦™åº”ç”¨

> **@date 2025-02-08**  
> **@author Wenjie.Xiang**

## ğŸ“‹ ç›®å½•
- [1. ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
- [2. è®¾è®¡æ¨¡å¼æ¶æ„åˆ†æ](#2-è®¾è®¡æ¨¡å¼æ¶æ„åˆ†æ)
- [3. ç­–ç•¥æ¨¡å¼çš„å®ç°](#3-ç­–ç•¥æ¨¡å¼çš„å®ç°)
- [4. å·¥å‚æ¨¡å¼çš„å®ç°](#4-å·¥å‚æ¨¡å¼çš„å®ç°)
- [5. æ ¸å¿ƒä»£ç è§£æ](#5-æ ¸å¿ƒä»£ç è§£æ)
- [6. æ‰©å±•æ€§è®¾è®¡](#6-æ‰©å±•æ€§è®¾è®¡)
- [7. æŠ€æœ¯äº®ç‚¹æ€»ç»“](#7-æŠ€æœ¯äº®ç‚¹æ€»ç»“)
- [8. æœ€ä½³å®è·µå»ºè®®](#8-æœ€ä½³å®è·µå»ºè®®)

## 1. ç³»ç»Ÿæ¦‚è¿°

HRæœ¬å‘¨å…³æ³¨ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ä¸šçº§äººåŠ›èµ„æºæ•°æ®åˆ†æå¹³å°ï¼Œé€šè¿‡**ç­–ç•¥æ¨¡å¼ + å·¥å‚æ¨¡å¼**çš„ç»„åˆï¼Œå®ç°äº†å¯¹å¤šç§HRä¸šåŠ¡åœºæ™¯çš„ç»Ÿä¸€å¤„ç†ã€‚ç³»ç»Ÿæ”¯æŒ10ç§ä¸åŒçš„ä¸šåŠ¡ç±»å‹ï¼ŒåŒ…æ‹¬è€ƒå‹¤å¼‚å¸¸ã€å»¶é•¿å·¥æ—¶ã€å‘˜å·¥ç”Ÿæ—¥ã€å…¥èŒå‘¨å¹´ç­‰ã€‚

### 1.1 ä¸šåŠ¡åœºæ™¯

```java
// æ”¯æŒçš„ä¸šåŠ¡ç±»å‹æšä¸¾
public enum OrgWeeklyFocusCodeEnum {
    ABNORMAL_ATTENDANCE,        // è€ƒå‹¤å¼‚å¸¸
    WORKING_HOURS,             // å·¥æ—¶æƒ…å†µ  
    EXTENDED_WORKING_HOURS,    // å»¶é•¿å·¥æ—¶
    ANNIVERSARY_OF_JOINING,    // å…¥èŒå‘¨å¹´
    BIRTHDAY,                  // ç”Ÿæ—¥
    LONG_LEAVE,               // é›†ä¸­ä¼‘å‡
    BUSINESS_TRIP_FIELDWORK,  // å‡ºå·®å¤–å‹¤
    ONBOARD,                  // å…¥èŒ
    RESIGNATION,              // ç¦»èŒ
    TRANSFER,                 // è°ƒåŠ¨
    REGULARIZATION            // è½¬æ­£
}
```

## 2. è®¾è®¡æ¨¡å¼æ¶æ„åˆ†æ

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Controller Layer                          â”‚
â”‚  OrgWeeklyFocusDataController                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Service Layer                               â”‚
â”‚  OrgWeeklyFocusDataService (ç»Ÿä¸€å…¥å£)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Strategy Interface                             â”‚
â”‚  OrgWeeklyFocusGenerateService (ç­–ç•¥æ¥å£)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Concrete Strategies                              â”‚
â”‚  â”œâ”€ OrgWeeklyFocusGenerateOvertimeServiceImpl              â”‚
â”‚  â”œâ”€ OrgWeeklyFocusGenerateBirthdayServiceImpl              â”‚
â”‚  â”œâ”€ OrgWeeklyFocusGenerateOnboardServiceImpl               â”‚
â”‚  â”œâ”€ OrgWeeklyFocusGenerateAnniversaryServiceImpl           â”‚
â”‚  â””â”€ ... (å…¶ä»–7ä¸ªå…·ä½“ç­–ç•¥å®ç°)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 è®¾è®¡æ¨¡å¼ç»„åˆä¼˜åŠ¿

| è®¾è®¡æ¨¡å¼ | ä½œç”¨ | ä¼˜åŠ¿ |
|---------|------|------|
| **ç­–ç•¥æ¨¡å¼** | å°è£…ä¸åŒä¸šåŠ¡ç±»å‹çš„å¤„ç†é€»è¾‘ | â€¢ ç®—æ³•ç‹¬ç«‹å˜åŒ–<br>â€¢ é¿å…å¤§é‡if-else<br>â€¢ æ˜“äºæ‰©å±•æ–°ä¸šåŠ¡ |
| **å·¥å‚æ¨¡å¼** | æ ¹æ®ä¸šåŠ¡ç±»å‹åˆ›å»ºå¯¹åº”ç­–ç•¥ | â€¢ è§£è€¦å¯¹è±¡åˆ›å»º<br>â€¢ ç»Ÿä¸€ç®¡ç†ç­–ç•¥<br>â€¢ æ”¯æŒåŠ¨æ€é€‰æ‹© |

## 3. ç­–ç•¥æ¨¡å¼çš„å®ç°

### 3.1 ç­–ç•¥æ¥å£è®¾è®¡

```java
/**
 * æ¯å‘¨å…³æ³¨æ•°æ®åˆå§‹åŒ–æœåŠ¡æ¥å£ (ç­–ç•¥æ¥å£)
 */
public interface OrgWeeklyFocusGenerateService {
    
    /**
     * åˆå§‹åŒ–æ¯å‘¨å…³æ³¨æ•°æ®
     */
    List<OrgWeeklyFocusDTO> initOrgWeeklyFocusData(OrgWeeklyFocusInitQuery query);
    
    /**
     * æ ‡è¯†ä¸šåŠ¡ç±»å‹ (å…³é”®æ–¹æ³• - å·¥å‚æ¨¡å¼çš„é€‰æ‹©ä¾æ®)
     */
    OrgWeeklyFocusCodeEnum getType();
    
    /**
     * ç”Ÿæˆé¡µé¢æ˜¾ç¤ºå†…å®¹
     */
    String viewGenerate(OrgWeeklyFocusViewQuery query);
    
    /**
     * ç”Ÿæˆé‚®ä»¶å†…å®¹ (æ”¯æŒä¸­è‹±æ–‡)
     */
    List<String> getMailContent(OrgWeeklyFocusViewQuery query);
    
    /**
     * ç”Ÿæˆè¯¦æƒ…é¡µé¢æ•°æ®
     */
    PageResultVO<OrgWeeklyFocusDtlDTO> viewDtlGenerate(
        OrgWeeklyFocusViewDtlQuery query, PageDTO pageDTO);
}
```

### 3.2 å…·ä½“ç­–ç•¥å®ç°ç¤ºä¾‹

#### å»¶é•¿å·¥æ—¶ç­–ç•¥å®ç°
```java
@Service
@Slf4j
public class OrgWeeklyFocusGenerateOvertimeServiceImpl 
    implements OrgWeeklyFocusGenerateService {
    
    @Override
    public OrgWeeklyFocusCodeEnum getType() {
        return OrgWeeklyFocusCodeEnum.EXTENDED_WORKING_HOURS;
    }
    
    @Override
    public List<OrgWeeklyFocusDTO> initOrgWeeklyFocusData(OrgWeeklyFocusInitQuery query) {
        // 1. è®¡ç®—ä¸Šå‘¨æ—¶é—´èŒƒå›´
        Date now = new Date();
        Date startDate = DateUtil.beginOfWeek(now);
        Date endDate = DateUtil.endOfWeek(now);
        startDate = DateUtils.addWeeks(startDate, -1);
        endDate = DateUtils.addWeeks(endDate, -1);
        
        // 2. éå†ç»„ç»‡æ¶æ„è·å–æ•°æ®
        List<OrgWeeklyFocusDTO> focusDTOList = new ArrayList<>();
        for (String setId : query.getSetids()) {
            // è·å–éƒ¨é—¨åˆ—è¡¨
            ComDeptQueryVO orgQuery = new ComDeptQueryVO();
            orgQuery.setSetid(setId);
            orgQuery.setDeptLevel(Arrays.asList("50", "60", "70"));
            
            List<String> childDeptList = commonRpcApi.findDeptList(orgQuery)
                .getData().stream()
                .map(ComDeptResultVO::getDeptid)
                .collect(Collectors.toList());
            
            // 3. è°ƒç”¨å¤–éƒ¨APIè·å–åŠ ç­æ•°æ®
            for (String deptId : childDeptList) {
                try {
                    String res = commonService.postGsmApi(interfaceUrl, param, "200", String.class);
                    JSONObject respJsonObj = parseObject(res);
                    
                    // å¤„ç†éƒ¨é—¨çº§æ•°æ®
                    BigDecimal avgOvertimeHours = respJsonObj.getBigDecimal("avgOvertimeHours");
                    OrgWeeklyFocusDTO weeklyFocusDTO = new OrgWeeklyFocusDTO();
                    weeklyFocusDTO.setEmplid(deptId);
                    weeklyFocusDTO.setDeptid(deptId);
                    weeklyFocusDTO.setBusinessDuration(avgOvertimeHours);
                    focusDTOList.add(weeklyFocusDTO);
                    
                    // å¤„ç†å‘˜å·¥çº§æ•°æ®
                    JSONArray empJsonArr = respJsonObj.getJSONArray("empList");
                    for (int k = 0; k < empJsonArr.size(); k++) {
                        JSONObject item = empJsonArr.getJSONObject(k);
                        // ... å¤„ç†ä¸ªäººåŠ ç­æ•°æ®
                    }
                } catch (Exception e) {
                    // å®¹é”™å¤„ç†ï¼šå•ä¸ªéƒ¨é—¨å¤±è´¥ä¸å½±å“æ•´ä½“
                    continue;
                }
            }
        }
        return focusDTOList;
    }
    
    @Override
    public String viewGenerate(OrgWeeklyFocusViewQuery query) {
        // è·å–é…ç½®æ¨¡æ¿
        OrgWeeklyFocusCodePO config = orgWeeklyFocusCodeService
            .getOrgWeeklyFocusCodeByCode(this.getType().getBusinessCode());
        
        // æŸ¥è¯¢æ•°æ®å¹¶æ’åº
        List<OrgWeeklyFocusPO> orgWeeklyFocusPOS = this.querySortOvertimeList(
            orgWeeklyFocusService.selectList(new LambdaQueryWrapper<OrgWeeklyFocusPO>()
                .eq(OrgWeeklyFocusPO::getBusinessCode, this.getType())
                .eq(OrgWeeklyFocusPO::getPeriod, query.getPeriod())
                .in(OrgWeeklyFocusPO::getDeptids, query.getDeptids())
            )
        );
        
        // å›½é™…åŒ–å†…å®¹ç”Ÿæˆ
        String content = LanguageEnum.isCn() ? 
            config.getBusinessContent() : config.getBusinessEnContent();
            
        if (orgWeeklyFocusPOS.isEmpty()) {
            return String.format(content, avgOvertimeHours.toPlainString());
        } else {
            // å–å‰ä¸‰åå‘˜å·¥
            List<String> overtimeEmplList = orgWeeklyFocusPOS.stream()
                .limit(3)
                .map(po -> {
                    String name = po.getEmplName();
                    String hours = po.getBusinessDuration().stripTrailingZeros().toPlainString();
                    return LanguageEnum.isCn() ? 
                        name + "(" + hours + "h)" : 
                        name + "(" + hours + " hours)";
                })
                .distinct()
                .collect(Collectors.toList());
                
            return String.format(content, avgOvertimeHours.toPlainString(), 
                String.join(", ", overtimeEmplList));
        }
    }
}
```

#### ç”Ÿæ—¥æé†’ç­–ç•¥å®ç°
```java
@Service
@Slf4j  
public class OrgWeeklyFocusGenerateBirthdayServiceImpl 
    implements OrgWeeklyFocusGenerateService {
    
    @Override
    public OrgWeeklyFocusCodeEnum getType() {
        return OrgWeeklyFocusCodeEnum.BIRTHDAY;
    }
    
    @Override
    public List<OrgWeeklyFocusDTO> initOrgWeeklyFocusData(OrgWeeklyFocusInitQuery query) {
        // è°ƒç”¨å‘˜å·¥RPCæ¥å£è·å–ç”Ÿæ—¥æ•°æ®
        ResultVo<List<OrgWeeklyFocusDTO>> result = 
            commonRpcApi.getWeeklyFocusData(query);
        
        if (!result.isSuccess()) {
            throw new RuntimeException(this.getType().getBusinessCode() + 
                " initOrgWeeklyFocusData error.");
        }
        return result.getData();
    }
    
    @Override
    public String viewGenerate(OrgWeeklyFocusViewQuery query) {
        // è·å–ç”Ÿæ—¥å‘˜å·¥åˆ—è¡¨
        List<OrgWeeklyFocusPO> birthdayList = this.queryBirthdayWeeklyFocusList(query);
        
        if (CollectionUtils.isEmpty(birthdayList)) {
            return "";
        }
        
        // ç”Ÿæˆæ˜¾ç¤ºå†…å®¹ï¼š"å¼ ä¸‰ã€æå››ç­‰3äººæœ¬å‘¨ç”Ÿæ—¥"
        OrgWeeklyFocusCodePO config = orgWeeklyFocusCodeService
            .getOrgWeeklyFocusCodeByCode(this.getType().getBusinessCode());
        String content = LanguageEnum.isCn() ? 
            config.getBusinessContent() : config.getBusinessEnContent();
            
        return String.format(content, birthdayList.size());
    }
}
```

## 4. å·¥å‚æ¨¡å¼çš„å®ç°

### 4.1 Springå®¹å™¨ä½œä¸ºå·¥å‚

ç³»ç»Ÿå·§å¦™åœ°åˆ©ç”¨Springçš„IoCå®¹å™¨ä½œä¸ºå·¥å‚ï¼Œé€šè¿‡`getType()`æ–¹æ³•è¿”å›çš„æšä¸¾å€¼æ¥æ ‡è¯†ä¸åŒçš„ç­–ç•¥å®ç°ï¼š

```java
@Service
public class OrgWeeklyFocusDataServiceImpl implements OrgWeeklyFocusDataService {
    
    @Override
    public void executeJob(String beanName, String value) {
        // Springå®¹å™¨ä½œä¸ºå·¥å‚ï¼Œæ ¹æ®beanNameè·å–å¯¹åº”çš„ç­–ç•¥å®ä¾‹
        Object jobBean = SpringContextHolder.getApplicationContext().getBean(beanName);
        
        if (jobBean instanceof OrgWeeklyFocusInitJob) {
            JobContext jobContext = new JobContext();
            Map<String, Object> map = new HashMap<>();
            map.put("businessType", value);  // ä¸šåŠ¡ç±»å‹ä½œä¸ºå‚æ•°
            jobContext.setParams(map);
            ((OrgWeeklyFocusInitJob) jobBean).run(jobContext);
        }
    }
}
```

### 4.2 ç­–ç•¥é€‰æ‹©æœºåˆ¶

é€šè¿‡ä¸šåŠ¡ç±»å‹æšä¸¾å®ç°ç­–ç•¥çš„è‡ªåŠ¨é€‰æ‹©ï¼š

```java
// æ§åˆ¶å™¨å±‚è°ƒç”¨
@PostMapping("/api/v2/org-weekly-focus/data")
public PageResultVO<OrgWeeklyFocusDtlVO> getOrgWeeklyFocusData(
    @RequestBody OrgWeeklyFocusInitQuery query) {
    
    // æ ¹æ®æŸ¥è¯¢æ¡ä»¶ä¸­çš„ä¸šåŠ¡ç±»å‹ï¼Œè‡ªåŠ¨é€‰æ‹©å¯¹åº”çš„ç­–ç•¥å®ç°
    focusService.initOrgWeeklyFocusData(query);
    return null;
}
```

### 4.3 åŠ¨æ€Beanæ³¨å†Œ

æ¯ä¸ªç­–ç•¥å®ç°ç±»éƒ½é€šè¿‡`@Service`æ³¨è§£è‡ªåŠ¨æ³¨å†Œåˆ°Springå®¹å™¨ï¼š

```java
// ç­–ç•¥å®ç°ç±»è‡ªåŠ¨æ³¨å†Œ
@Service  // è‡ªåŠ¨æ³¨å†Œä¸ºSpring Bean
public class OrgWeeklyFocusGenerateOvertimeServiceImpl implements OrgWeeklyFocusGenerateService {
    @Override
    public OrgWeeklyFocusCodeEnum getType() {
        return OrgWeeklyFocusCodeEnum.EXTENDED_WORKING_HOURS;  // ç­–ç•¥æ ‡è¯†
    }
}

@Service  // è‡ªåŠ¨æ³¨å†Œä¸ºSpring Bean  
public class OrgWeeklyFocusGenerateBirthdayServiceImpl implements OrgWeeklyFocusGenerateService {
    @Override
    public OrgWeeklyFocusCodeEnum getType() {
        return OrgWeeklyFocusCodeEnum.BIRTHDAY;  // ç­–ç•¥æ ‡è¯†
    }
}
```

## 5. æ ¸å¿ƒä»£ç è§£æ

### 5.1 ä¸šåŠ¡ç±»å‹æšä¸¾è®¾è®¡

```java
@Getter
public enum OrgWeeklyFocusCodeEnum {
    
    EXTENDED_WORKING_HOURS("EXTENDED_WORKING_HOURS", "å»¶é•¿å·¥æ—¶", "Extended working hours",
            OrgWeeklyFocusCodeTypeEnum.PRE_WEEK, OrgWeeklyFocusGroupEnum.HYGIENE_ATTENDANCE),
    
    BIRTHDAY("BIRTHDAY", "ç”Ÿæ—¥", "Birthday",
            OrgWeeklyFocusCodeTypeEnum.CURR_WEEK, OrgWeeklyFocusGroupEnum.CARE),
    
    ONBOARD("ONBOARD", "å…¥èŒ", "Onboard", 
            OrgWeeklyFocusCodeTypeEnum.CURR_WEEK, OrgWeeklyFocusGroupEnum.CHANGE);
    
    private final String businessCode;      // ä¸šåŠ¡ç¼–ç 
    private final String businessDesc;      // ä¸­æ–‡æè¿°  
    private final String businessDescEn;    // è‹±æ–‡æè¿°
    private final OrgWeeklyFocusCodeTypeEnum weekType;  // æ—¶é—´ç±»å‹(æœ¬å‘¨/ä¸Šå‘¨)
    private final OrgWeeklyFocusGroupEnum group;        // ä¸šåŠ¡åˆ†ç»„
}
```

**è®¾è®¡äº®ç‚¹ï¼š**
- **å¤šç»´åº¦åˆ†ç±»**ï¼šæŒ‰æ—¶é—´ç±»å‹ã€ä¸šåŠ¡åˆ†ç»„è¿›è¡Œåˆ†ç±»
- **å›½é™…åŒ–æ”¯æŒ**ï¼šåŒæ—¶æä¾›ä¸­è‹±æ–‡æè¿°
- **æ‰©å±•æ€§**ï¼šæ–°å¢ä¸šåŠ¡ç±»å‹åªéœ€æ·»åŠ æšä¸¾å€¼

### 5.2 æ™ºèƒ½æ’åºç®—æ³•

```java
/**
 * è¿‡æ»¤å‡ºæœ‰æ•ˆå»¶é•¿å·¥æ—¶å¹¶æŒ‰æ—¶é•¿å€’åºæ’åˆ—çš„å‘˜å·¥åˆ—è¡¨
 */
private List<OrgWeeklyFocusPO> querySortOvertimeList(List<OrgWeeklyFocusPO> orgWeeklyFocusPOS) {
    // 1. æ‰‹åŠ¨å»é‡ï¼ˆä¿è¯å‘˜å·¥å”¯ä¸€æ€§ï¼‰
    List<OrgWeeklyFocusPO> distinctList = new ArrayList<>();
    Set<String> keySet = new HashSet<>();
    for (OrgWeeklyFocusPO po : orgWeeklyFocusPOS) {
        String key = po.getEmplid();
        if (!keySet.contains(key)) {
            keySet.add(key);
            distinctList.add(po);
        }
    }
    
    // 2. è¿‡æ»¤å’Œæ’åº
    return distinctList.stream()
            .filter(item -> !item.getEmplid().equals(item.getDeptid()))  // è¿‡æ»¤éƒ¨é—¨çº§æ•°æ®
            .sorted((item1, item2) -> {
                // åŒé‡æ’åºï¼šå…ˆæŒ‰æ—¶é•¿é™åºï¼Œæ—¶é•¿ç›¸åŒæŒ‰å‘˜å·¥IDå‡åº
                if (item1.getBusinessDuration().compareTo(item2.getBusinessDuration()) == 0) {
                    return item1.getEmplid().compareTo(item2.getEmplid());
                }
                return item2.getBusinessDuration().compareTo(item1.getBusinessDuration());
            })
            .collect(Collectors.toList());
}
```

### 5.3 å›½é™…åŒ–å†…å®¹ç”Ÿæˆ

```java
@Override
public String viewGenerate(OrgWeeklyFocusViewQuery query) {
    // 1. è·å–é…ç½®æ¨¡æ¿
    OrgWeeklyFocusCodePO config = orgWeeklyFocusCodeService
        .getOrgWeeklyFocusCodeByCode(this.getType().getBusinessCode());
    
    // 2. æ ¹æ®è¯­è¨€ç¯å¢ƒé€‰æ‹©æ¨¡æ¿
    String content = LanguageEnum.isCn() ? 
        config.getBusinessContent() : config.getBusinessEnContent();
    
    // 3. ç”Ÿæˆå‘˜å·¥åˆ—è¡¨ï¼ˆæ”¯æŒä¸­è‹±æ–‡æ ¼å¼ï¼‰
    List<String> employeeList = orgWeeklyFocusPOS.stream()
        .limit(3)  // åªæ˜¾ç¤ºå‰3å
        .map(po -> {
            String name = po.getEmplName();
            String hours = po.getBusinessDuration().stripTrailingZeros().toPlainString();
            if (LanguageEnum.isCn()) {
                return name + "(" + hours + "h)";
            } else {
                return name + "(" + hours + " hours)";
            }
        })
        .distinct()
        .collect(Collectors.toList());
    
    // 4. æ ¼å¼åŒ–æœ€ç»ˆå†…å®¹
    String employeeStr = String.join(", ", employeeList);
    return String.format(content, avgOvertimeHours.toPlainString(), employeeStr);
}
```

## 6. æ‰©å±•æ€§è®¾è®¡

### 6.1 æ–°å¢ä¸šåŠ¡ç±»å‹çš„æ­¥éª¤

1. **æ·»åŠ æšä¸¾å€¼**
```java
public enum OrgWeeklyFocusCodeEnum {
    // æ–°å¢ç»©æ•ˆé¢„è­¦ä¸šåŠ¡ç±»å‹
    PERFORMANCE_ALERT("PERFORMANCE_ALERT", "ç»©æ•ˆé¢„è­¦", "Performance Alert",
            OrgWeeklyFocusCodeTypeEnum.CURR_WEEK, OrgWeeklyFocusGroupEnum.CARE);
}
```

2. **åˆ›å»ºç­–ç•¥å®ç°ç±»**
```java
@Service
@Slf4j
public class OrgWeeklyFocusGeneratePerformanceServiceImpl 
    implements OrgWeeklyFocusGenerateService {
    
    @Override
    public OrgWeeklyFocusCodeEnum getType() {
        return OrgWeeklyFocusCodeEnum.PERFORMANCE_ALERT;
    }
    
    @Override
    public List<OrgWeeklyFocusDTO> initOrgWeeklyFocusData(OrgWeeklyFocusInitQuery query) {
        // å®ç°ç»©æ•ˆæ•°æ®è·å–é€»è¾‘
        return performanceRpcApi.getPerformanceAlertData(query);
    }
    
    @Override
    public String viewGenerate(OrgWeeklyFocusViewQuery query) {
        // å®ç°ç»©æ•ˆé¢„è­¦å†…å®¹ç”Ÿæˆé€»è¾‘
        return generatePerformanceAlertContent(query);
    }
}
```

3. **é…ç½®æ•°æ®åº“æ¨¡æ¿**
```sql
INSERT INTO org_weekly_focus_code (business_code, business_content, business_en_content) 
VALUES ('PERFORMANCE_ALERT', '{0}äººæœ¬å‘¨ç»©æ•ˆé¢„è­¦', '{0} employees have performance alerts this week');
```

### 6.2 ç³»ç»Ÿè‡ªåŠ¨å‘ç°æœºåˆ¶

ç”±äºä½¿ç”¨äº†Springçš„IoCå®¹å™¨å’Œç­–ç•¥æ¨¡å¼ï¼Œæ–°å¢çš„ä¸šåŠ¡ç±»å‹ä¼šè¢«è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ã€‚

## 7. æŠ€æœ¯äº®ç‚¹æ€»ç»“

### 7.1 è®¾è®¡æ¨¡å¼ä¼˜åŠ¿

| ä¼˜åŠ¿ | ç­–ç•¥æ¨¡å¼è´¡çŒ® | å·¥å‚æ¨¡å¼è´¡çŒ® |
|------|-------------|-------------|
| **å¯æ‰©å±•æ€§** | æ–°å¢ç®—æ³•ä¸å½±å“ç°æœ‰ä»£ç  | æ–°å¢ç­–ç•¥è‡ªåŠ¨æ³¨å†Œ |
| **å¯ç»´æŠ¤æ€§** | æ¯ä¸ªç­–ç•¥ç‹¬ç«‹ç»´æŠ¤ | ç»Ÿä¸€çš„åˆ›å»ºå…¥å£ |
| **å¯æµ‹è¯•æ€§** | ç­–ç•¥å¯ç‹¬ç«‹å•å…ƒæµ‹è¯• | Mockå·¥å‚ä¾¿äºæµ‹è¯• |
| **ä»£ç å¤ç”¨** | å…¬å…±æ¥å£å®šä¹‰ç»Ÿä¸€è¡Œä¸º | é¿å…é‡å¤çš„åˆ›å»ºé€»è¾‘ |

### 7.2 æ¶æ„è®¾è®¡äº®ç‚¹

1. **å¤šå±‚æ•°æ®å¤„ç†**ï¼šåŒæ—¶å¤„ç†éƒ¨é—¨çº§å’Œä¸ªäººçº§æ•°æ®
2. **å®¹é”™æœºåˆ¶**ï¼šå•ä¸ªæ•°æ®æºå¤±è´¥ä¸å½±å“æ•´ä½“æµç¨‹
3. **å›½é™…åŒ–æ”¯æŒ**ï¼šä¸­è‹±æ–‡å†…å®¹è‡ªåŠ¨åˆ‡æ¢
4. **æ™ºèƒ½æ’åº**ï¼šå¤šç»´åº¦æ’åºç®—æ³•
5. **æ¨¡æ¿åŒ–é…ç½®**ï¼šå†…å®¹æ¨¡æ¿å¯é…ç½®åŒ–ç®¡ç†

### 7.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

```java
// 1. æ‰¹é‡å¤„ç†å‡å°‘RPCè°ƒç”¨
List<String> deptIds = query.getSetids().stream()
    .flatMap(setId -> getDeptList(setId).stream())
    .collect(Collectors.toList());

// 2. å¼‚å¸¸å®¹é”™ä¸ä¸­æ–­æµç¨‹  
try {
    String res = commonService.postGsmApi(interfaceUrl, param, "200", String.class);
    // å¤„ç†å“åº”
} catch (Exception e) {
    continue;  // ç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ªï¼Œä¸ä¸­æ–­æ•´ä½“æµç¨‹
}

// 3. æµå¼å¤„ç†æå‡æ€§èƒ½
List<String> result = orgWeeklyFocusPOS.stream()
    .filter(item -> !item.getEmplid().equals(item.getDeptid()))
    .sorted(Comparator.comparing(OrgWeeklyFocusPO::getBusinessDuration).reversed())
    .limit(3)
    .map(this::formatEmployeeInfo)
    .collect(Collectors.toList());
```

## 8. æœ€ä½³å®è·µå»ºè®®

### 8.1 ç­–ç•¥æ¨¡å¼æœ€ä½³å®è·µ

1. **æ¥å£è®¾è®¡åŸåˆ™**
   - ä¿æŒæ¥å£ç®€æ´ï¼ŒèŒè´£å•ä¸€
   - æä¾›é»˜è®¤å®ç°å‡å°‘é‡å¤ä»£ç 
   - è€ƒè™‘å¼‚æ­¥å¤„ç†èƒ½åŠ›

2. **ç­–ç•¥å®ç°è§„èŒƒ**
   - æ¯ä¸ªç­–ç•¥ä¸“æ³¨å•ä¸€ä¸šåŠ¡åœºæ™¯
   - å®ç°ç±»å‘½åè§„èŒƒç»Ÿä¸€
   - æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£æ³¨é‡Š

3. **å¼‚å¸¸å¤„ç†ç­–ç•¥**
   - ç­–ç•¥å†…éƒ¨å¼‚å¸¸ä¸åº”å½±å“å…¶ä»–ç­–ç•¥
   - æä¾›é™çº§å¤„ç†æœºåˆ¶
   - è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

### 8.2 å·¥å‚æ¨¡å¼æœ€ä½³å®è·µ

1. **Beanç®¡ç†**
   - åˆ©ç”¨Springå®¹å™¨ç®¡ç†ç­–ç•¥å®ä¾‹
   - é¿å…æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡
   - åˆç†ä½¿ç”¨å•ä¾‹æ¨¡å¼

2. **ç­–ç•¥é€‰æ‹©**
   - é€šè¿‡æšä¸¾è€Œéå­—ç¬¦ä¸²æ ‡è¯†ç­–ç•¥
   - æä¾›ç­–ç•¥éªŒè¯æœºåˆ¶
   - æ”¯æŒåŠ¨æ€ç­–ç•¥åˆ‡æ¢

3. **æ‰©å±•æ€§è®¾è®¡**
   - é¢„ç•™æ‰©å±•æ¥å£
   - æ”¯æŒæ’ä»¶åŒ–æ¶æ„
   - è€ƒè™‘é…ç½®åŒ–ç®¡ç†

### 8.3 ç³»ç»Ÿé›†æˆå»ºè®®

1. **ç¼“å­˜ç­–ç•¥**
```java
@Cacheable(value = "weeklyFocus", key = "#query.businessCode + '_' + #query.period")
public String viewGenerate(OrgWeeklyFocusViewQuery query) {
    // å®ç°é€»è¾‘
}
```

2. **ç›‘æ§å‘Šè­¦**
```java
@Override
public List<OrgWeeklyFocusDTO> initOrgWeeklyFocusData(OrgWeeklyFocusInitQuery query) {
    long startTime = System.currentTimeMillis();
    try {
        // ä¸šåŠ¡é€»è¾‘
        return result;
    } finally {
        long duration = System.currentTimeMillis() - startTime;
        monitorService.recordMetrics(this.getType(), duration, result.size());
    }
}
```

3. **å¼‚æ­¥å¤„ç†**
```java
@Async("weeklyFocusExecutor")
public CompletableFuture<List<OrgWeeklyFocusDTO>> initOrgWeeklyFocusDataAsync(
    OrgWeeklyFocusInitQuery query) {
    return CompletableFuture.completedFuture(initOrgWeeklyFocusData(query));
}
```

## ğŸ¯ æ€»ç»“

è¿™ä¸ªHRæœ¬å‘¨å…³æ³¨ç³»ç»Ÿé€šè¿‡**ç­–ç•¥æ¨¡å¼ + å·¥å‚æ¨¡å¼**çš„å·§å¦™ç»“åˆï¼Œå®ç°äº†ï¼š

- âœ… **é«˜æ‰©å±•æ€§**ï¼šæ–°å¢ä¸šåŠ¡ç±»å‹åªéœ€æ·»åŠ ç­–ç•¥å®ç°ç±»
- âœ… **é«˜å†…èšä½è€¦åˆ**ï¼šæ¯ä¸ªç­–ç•¥ç‹¬ç«‹å®ç°ï¼Œäº’ä¸å½±å“  
- âœ… **æ˜“äºç»´æŠ¤**ï¼šç­–ç•¥é€»è¾‘æ¸…æ™°ï¼Œä¾¿äºè°ƒè¯•å’Œä¼˜åŒ–
- âœ… **å›½é™…åŒ–æ”¯æŒ**ï¼šç»Ÿä¸€çš„å¤šè¯­è¨€å¤„ç†æœºåˆ¶
- âœ… **æ€§èƒ½ä¼˜åŒ–**ï¼šæ™ºèƒ½çš„æ•°æ®å¤„ç†å’Œå®¹é”™æœºåˆ¶

è¯¥è®¾è®¡æ¨¡å¼çš„åº”ç”¨ä¸ºä¼ä¸šçº§HRç³»ç»Ÿçš„æ¶æ„è®¾è®¡æä¾›äº†ä¼˜ç§€çš„å‚è€ƒèŒƒä¾‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤šä¸šåŠ¡åœºæ™¯ã€å¤šæ•°æ®æºé›†æˆç­‰å¤æ‚åœºæ™¯æ—¶ï¼Œå±•ç°å‡ºäº†å¼ºå¤§çš„æŠ€æœ¯ä»·å€¼ã€‚

---

> ğŸ’¡ **æŠ€æœ¯å¯å‘**ï¼šåœ¨é¢å¯¹å¤šç§ç›¸ä¼¼ä½†åˆæœ‰å·®å¼‚çš„ä¸šåŠ¡åœºæ™¯æ—¶ï¼Œç­–ç•¥æ¨¡å¼+å·¥å‚æ¨¡å¼çš„ç»„åˆæ˜¯ä¸€ä¸ªéå¸¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒä¸ä»…è§£å†³äº†å½“å‰çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ›´ä¸ºæœªæ¥çš„æ‰©å±•å¥ å®šäº†åšå®çš„æ¶æ„åŸºç¡€ã€‚