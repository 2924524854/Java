# ç°åº¦äººå‘˜æ¥å£é…ç½®æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°
ç°åº¦äººå‘˜æ¥å£æ”¯æŒå¤šç»´åº¦çš„ç”¨æˆ·è®¿é—®æ§åˆ¶ï¼Œå¯ä»¥åŸºäºç”¨æˆ·è´¦å·ã€éƒ¨é—¨ã€ä¸šåŠ¡å•ä½(setid)ã€å·¥ä½œå›½å®¶ç­‰æ¡ä»¶è¿›è¡Œç²¾ç»†åŒ–çš„ç°åº¦å‘å¸ƒæ§åˆ¶ã€‚

### æ”¯æŒçš„æ§åˆ¶ç»´åº¦
- âœ… **ç”¨æˆ·çº§æ§åˆ¶**: ç›´æ¥æŒ‡å®šç”¨æˆ·è´¦å·
- âœ… **éƒ¨é—¨çº§æ§åˆ¶**: æŒ‡å®šéƒ¨é—¨åŠå…¶å­éƒ¨é—¨
- âœ… **ä¸šåŠ¡å•ä½æ§åˆ¶**: é™åˆ¶ç‰¹å®šçš„setid
- âœ… **åœ°åŒºæ§åˆ¶**: é™åˆ¶ç‰¹å®šçš„å·¥ä½œå›½å®¶
- âœ… **ç»„åˆæ§åˆ¶**: å¤šä¸ªç»´åº¦åŒæ—¶ç”Ÿæ•ˆ

## ğŸ”§ æ¥å£ä¿¡æ¯

### API åœ°å€
**å†…éƒ¨æ¥å£**
```
GET /api/v2/com-emp-base/gray-user?oprid={è´¦å·}&businessTag={ä¸šåŠ¡æ ‡è¯†}
```

**å¼€æ”¾æ¥å£**
```
GET /openapi/v2/com-emp-base/gray-user?oprid={è´¦å·}&businessTag={ä¸šåŠ¡æ ‡è¯†}
```

### è¿”å›å€¼
- `1`: æ˜¯ç°åº¦ç”¨æˆ·
- `0`: ä¸æ˜¯ç°åº¦ç”¨æˆ·

## ğŸ—ƒï¸ æ•°æ®åº“é…ç½®

### é…ç½®è¡¨
```sql
-- è¡¨å: t_com_defn_cfg_dtl
```

### å­—æ®µè¯´æ˜
| å­—æ®µå | è¯´æ˜ |
|-------|------|
| defn_id | ä¸šåŠ¡æ ‡è¯† |
| defn_key | é…ç½®é”®å€¼ï¼ˆç”¨æˆ·è´¦å·æˆ–éƒ¨é—¨é…ç½®ï¼‰ |
| defn_value1 | ä¸šåŠ¡å•ä½(setid)åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ |
| defn_value2 | å·¥ä½œå›½å®¶åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ |
| descr | é…ç½®æè¿° |

## ğŸ“ é…ç½®æ–¹å¼

### 1. ç”¨æˆ·çº§é…ç½®
ç›´æ¥æŒ‡å®šç”¨æˆ·è´¦å·ï¼Œæœ€é«˜ä¼˜å…ˆçº§ã€‚

```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, descr) VALUES 
('FILE_RPT_GRAY_LIST', 'zhang001', 'æŒ‡å®šç”¨æˆ·å¼ ä¸‰'),
('FILE_RPT_GRAY_LIST', 'li002', 'æŒ‡å®šç”¨æˆ·æå››'),
('FILE_RPT_GRAY_LIST', 'wang003', 'æŒ‡å®šç”¨æˆ·ç‹äº”');
```

### 2. éƒ¨é—¨çº§é…ç½®

#### 2.1 ä»…éƒ¨é—¨é™åˆ¶
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('FILE_RPT_GRAY_LIST', 'dept_IT001,IT002,IT003', NULL, NULL, 'ITç›¸å…³éƒ¨é—¨åŠå­éƒ¨é—¨');
```

#### 2.2 éƒ¨é—¨ + setid é™åˆ¶
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('FILE_RPT_GRAY_LIST', 'dept_HR001,HR002', 'OPPO,REALME', NULL, 'HRéƒ¨é—¨-ä»…OPPOå’ŒREALMEä¸šåŠ¡å•ä½');
```

#### 2.3 éƒ¨é—¨ + å·¥ä½œå›½å®¶é™åˆ¶
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('FILE_RPT_GRAY_LIST', 'dept_FIN001', NULL, 'CN,US', 'è´¢åŠ¡éƒ¨é—¨-ä»…ä¸­ç¾åœ°åŒº');
```

#### 2.4 éƒ¨é—¨ + setid + å·¥ä½œå›½å®¶ï¼ˆå…¨ç»´åº¦é™åˆ¶ï¼‰
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('FILE_RPT_GRAY_LIST', 'dept_R&D001,R&D002', 'OPPO', 'CN,IN', 'ç ”å‘éƒ¨é—¨-OPPO-ä¸­å°åœ°åŒº');
```

## ğŸ¯ åˆ¤æ–­é€»è¾‘

### ä¼˜å…ˆçº§é¡ºåº
1. **ç”¨æˆ·è´¦å·ç›´æ¥åŒ¹é…** â†’ ç«‹å³è¿”å› trueï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼Œæ€§èƒ½æœ€ä¼˜ï¼‰
2. **éƒ¨é—¨è§„åˆ™åŒ¹é…** â†’ éœ€åŒæ—¶æ»¡è¶³æ‰€æœ‰é…ç½®çš„ç»´åº¦æ¡ä»¶
3. **æ— åŒ¹é…** â†’ è¿”å› false

### å¤„ç†é¡ºåºä¼˜åŒ–
ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹é¡ºåºå¤„ç†é…ç½®ï¼š
1. **ç¬¬ä¸€è½®**: éå†æ‰€æœ‰é…ç½®ï¼Œä¼˜å…ˆå¤„ç†ç”¨æˆ·çº§é…ç½®ï¼ˆé dept_ å¼€å¤´ï¼‰
2. **ç¬¬äºŒè½®**: å¦‚æœç”¨æˆ·çº§é…ç½®æ— åŒ¹é…ï¼Œå†å¤„ç†éƒ¨é—¨çº§é…ç½®ï¼ˆdept_ å¼€å¤´ï¼‰

è¿™æ ·çš„è®¾è®¡ç¡®ä¿äº†ï¼š
- âœ… **æ€§èƒ½æœ€ä¼˜**: ç”¨æˆ·è´¦å·åŒ¹é…æ— éœ€å¤æ‚è®¡ç®—ï¼Œç›´æ¥è¿”å›
- âœ… **é€»è¾‘æ¸…æ™°**: ç”¨æˆ·çº§é…ç½®å§‹ç»ˆæ‹¥æœ‰æœ€é«˜ä¼˜å…ˆçº§
- âœ… **é¿å…æµªè´¹**: ç”¨æˆ·å·²åœ¨ç™½åå•æ—¶ï¼Œä¸æ‰§è¡Œå¤æ‚çš„éƒ¨é—¨åˆ¤æ–­

### éƒ¨é—¨è§„åˆ™æ¡ä»¶ï¼ˆANDå…³ç³»ï¼‰
ç”¨æˆ·å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶ï¼š
- âœ… **éƒ¨é—¨åŒ¹é…**: ç”¨æˆ·æ‰€åœ¨éƒ¨é—¨ âˆˆ {é…ç½®çš„éƒ¨é—¨æˆ–å…¶å­éƒ¨é—¨}
- âœ… **setidåŒ¹é…**: ç”¨æˆ·setid âˆˆ {defn_value1é…ç½®çš„setidåˆ—è¡¨} (å¦‚æœé…ç½®äº†)
- âœ… **å·¥ä½œå›½å®¶åŒ¹é…**: ç”¨æˆ·å·¥ä½œå›½å®¶ âˆˆ {defn_value2é…ç½®çš„å›½å®¶åˆ—è¡¨} (å¦‚æœé…ç½®äº†)

## ğŸ“Š é…ç½®ç¤ºä¾‹

### åœºæ™¯1: æ–°åŠŸèƒ½æ¸è¿›å¼å‘å¸ƒ

**ç¬¬ä¸€é˜¶æ®µï¼šä»…ITéƒ¨é—¨æµ‹è¯•**
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, descr) VALUES 
('NEW_FEATURE_GRAY', 'dept_IT001', 'ITéƒ¨é—¨æµ‹è¯•é˜¶æ®µ');
```

**ç¬¬äºŒé˜¶æ®µï¼šæ‰©å±•åˆ°æ‰€æœ‰æŠ€æœ¯ç›¸å…³éƒ¨é—¨**
```sql
UPDATE t_com_defn_cfg_dtl 
SET defn_key = 'dept_IT001,IT002,R&D001,R&D002' 
WHERE defn_id = 'NEW_FEATURE_GRAY';
```

**ç¬¬ä¸‰é˜¶æ®µï¼šæ·»åŠ ç‰¹å®šç”¨æˆ·**
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, descr) VALUES 
('NEW_FEATURE_GRAY', 'zhang001', 'äº§å“ç»ç†å¼ ä¸‰'),
('NEW_FEATURE_GRAY', 'li002', 'æµ‹è¯•ä¸»ç®¡æå››');
```

### åœºæ™¯2: åœ°åŒºæ€§åŠŸèƒ½å‘å¸ƒ

**ä»…ä¸­å›½åœ°åŒºçš„HRå’Œè´¢åŠ¡éƒ¨é—¨**
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('REGION_FEATURE_GRAY', 'dept_HR001,FIN001', NULL, 'CN', 'ä¸­å›½åœ°åŒºHRè´¢åŠ¡åŠŸèƒ½');
```

**ç¾å›½åœ°åŒºçš„æ‰€æœ‰OPPOå‘˜å·¥**
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('REGION_FEATURE_GRAY', 'dept_ALL001', 'OPPO', 'US', 'ç¾å›½OPPOå…¨å‘˜');
```

### åœºæ™¯3: ä¸šåŠ¡å•ä½éš”ç¦»

**REALMEä¸šåŠ¡çš„æŠ€æœ¯éƒ¨é—¨**
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('REALME_FEATURE_GRAY', 'dept_IT001,R&D001', 'REALME,RIND1', NULL, 'REALMEæŠ€æœ¯éƒ¨é—¨');
```

**OPPOä¸šåŠ¡çš„ç®¡ç†å±‚**
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('REALME_FEATURE_GRAY', 'dept_MGMT001', 'OPPO', NULL, 'OPPOç®¡ç†å±‚');
```

## ğŸ› ï¸ æœ€ä½³å®è·µ

### 1. å‘½åè§„èŒƒ
```sql
-- æ¨èçš„ä¸šåŠ¡æ ‡è¯†å‘½å
'FEATURE_NAME_GRAY'        -- åŠŸèƒ½å_GRAY
'MODULE_NAME_BETA'         -- æ¨¡å—å_BETA  
'SYSTEM_NAME_TEST'         -- ç³»ç»Ÿå_TEST
```

### 2. é…ç½®ç­–ç•¥
- **æ¸è¿›å¼å‘å¸ƒ**: ä»å°èŒƒå›´åˆ°å¤§èŒƒå›´
- **ç»´åº¦ç»„åˆ**: ä¼˜å…ˆä½¿ç”¨éƒ¨é—¨+åœ°åŒºç»„åˆï¼Œé¿å…è¿‡åº¦å¤æ‚
- **æ¸…æ™°æè¿°**: é…ç½®æè¿°è¦æ˜ç¡®è¯´æ˜é€‚ç”¨èŒƒå›´
- **åŠæ—¶æ¸…ç†**: åŠŸèƒ½å…¨é‡å‘å¸ƒååŠæ—¶æ¸…ç†ç°åº¦é…ç½®

### 3. ç›‘æ§å»ºè®®
- è®°å½•ç°åº¦ç”¨æˆ·è®¿é—®æ—¥å¿—
- ç›‘æ§å„ç»´åº¦çš„åŒ¹é…æƒ…å†µ
- å®šæœŸæ£€æŸ¥é…ç½®çš„æœ‰æ•ˆæ€§

## ğŸ” è°ƒè¯•æŒ‡å—

### 1. æ—¥å¿—æŸ¥çœ‹
ç³»ç»Ÿä¼šè®°å½•è¯¦ç»†çš„åŒ¹é…æ—¥å¿—ï¼š

**ç”¨æˆ·è´¦å·ç›´æ¥åŒ¹é…**
```
INFO isGrayUser: ç”¨æˆ·è´¦å·ç›´æ¥åŒ¹é…, oprid=zhang001, defnKey=zhang001
```

**éƒ¨é—¨ç›´æ¥åŒ¹é…**
```
INFO isGrayUser: ç”¨æˆ·å®Œå…¨åŒ¹é…éƒ¨é—¨ç°åº¦é…ç½®, oprid=li002, userDeptId=IT001, userSetId=OPPO, userCountry=CN, configDeptId=IT001, defnKey=dept_IT001
```

**å­éƒ¨é—¨åŒ¹é…**
```
INFO isGrayUser: ç”¨æˆ·å®Œå…¨åŒ¹é…å­éƒ¨é—¨ç°åº¦é…ç½®, oprid=wang003, userDeptId=IT001-SUB, userSetId=OPPO, userCountry=CN, configDeptId=IT001, defnKey=dept_IT001
```

**setidä¸åŒ¹é…**
```
INFO isGrayUser: ç”¨æˆ·setidä¸åŒ¹é…é…ç½®, oprid=zhao004, userSetId=REALME, configSetIds=OPPO, defnKey=dept_IT001
```

**å·¥ä½œå›½å®¶ä¸åŒ¹é…**
```
INFO isGrayUser: ç”¨æˆ·å·¥ä½œå›½å®¶ä¸åŒ¹é…é…ç½®, oprid=qian005, userCountry=IN, configCountries=CN,US, defnKey=dept_IT001
```

### 2. å¸¸è§é—®é¢˜æ’æŸ¥

#### Q1: ç”¨æˆ·åœ¨éƒ¨é—¨ä¸­ä½†ä¸æ˜¯ç°åº¦ç”¨æˆ·
**æ£€æŸ¥é¡¹ç›®**:
- ç¡®è®¤éƒ¨é—¨IDé…ç½®æ­£ç¡®
- æ£€æŸ¥setidé™åˆ¶ï¼ˆdefn_value1ï¼‰
- æ£€æŸ¥å·¥ä½œå›½å®¶é™åˆ¶ï¼ˆdefn_value2ï¼‰
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—å®šä½å…·ä½“åŸå› 

#### Q2: å­éƒ¨é—¨ç”¨æˆ·æ— æ³•è®¿é—®
**æ£€æŸ¥é¡¹ç›®**:
- ç¡®è®¤éƒ¨é—¨å…³ç³»è¡¨ t_com_dept_rela æ•°æ®æ­£ç¡®
- æ£€æŸ¥setidæ˜¯å¦ä¸€è‡´
- éªŒè¯å­éƒ¨é—¨æŸ¥è¯¢é€»è¾‘

#### Q3: é…ç½®ä¸ç”Ÿæ•ˆ
**æ£€æŸ¥é¡¹ç›®**:
- ç¡®è®¤ defn_id åŒ¹é…APIè°ƒç”¨çš„ businessTag
- æ£€æŸ¥é…ç½®æ•°æ®æ ¼å¼ï¼ˆé€—å·åˆ†éš”ï¼Œæ— å¤šä½™ç©ºæ ¼ï¼‰
- éªŒè¯ç”¨æˆ·åŸºæœ¬ä¿¡æ¯æ˜¯å¦å®Œæ•´

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. é…ç½®ä¼˜åŒ–
- é¿å…è¿‡å¤šçš„éƒ¨é—¨é…ç½®é¡¹
- åˆç†ä½¿ç”¨setidå’Œå›½å®¶é™åˆ¶å‡å°‘åŒ¹é…èŒƒå›´
- å®šæœŸæ¸…ç†æ— æ•ˆé…ç½®

### 2. æŸ¥è¯¢ä¼˜åŒ–
- ç³»ç»Ÿå·²ä¼˜åŒ–å­éƒ¨é—¨æŸ¥è¯¢ï¼Œä½¿ç”¨é«˜æ•ˆçš„å¸ƒå°”åˆ¤æ–­
- ç¼“å­˜æœºåˆ¶ç¡®ä¿ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢æ€§èƒ½
- æ”¯æŒå¹¶å‘è®¿é—®

## ğŸš€ å‡çº§è¿ç§»

### ä»æ—§ç‰ˆæœ¬è¿ç§»
å¦‚æœæ‚¨ä¹‹å‰ä½¿ç”¨çš„æ˜¯ç®€å•çš„ç”¨æˆ·åˆ—è¡¨é…ç½®ï¼š

**æ—§é…ç½®ä¿æŒä¸å˜**
```sql
SELECT * FROM t_com_defn_cfg_dtl WHERE defn_id = 'FILE_RPT_GRAY_LIST' AND defn_key NOT LIKE 'dept_%';
```

**æ–°å¢éƒ¨é—¨é…ç½®**
```sql
INSERT INTO t_com_defn_cfg_dtl (defn_id, defn_key, defn_value1, defn_value2, descr) VALUES 
('FILE_RPT_GRAY_LIST', 'dept_YOUR_DEPT_ID', 'YOUR_SETID', 'YOUR_COUNTRY', 'æ‚¨çš„éƒ¨é—¨é…ç½®');
```

## ğŸ¤ æŠ€æœ¯æ”¯æŒ
å¦‚æœ‰é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
- ç”¨æˆ·è´¦å· (oprid)
- ä¸šåŠ¡æ ‡è¯† (businessTag)
- é¢„æœŸç»“æœ vs å®é™…ç»“æœ
- ç›¸å…³é…ç½®è®°å½•
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—




INSERT INTO `corehrpt_common`.`t_com_defn_cfg_dtl` (`defn_id`, `descr`, `defn_key`, `defn_value1`, `defn_value2`, `defn_value3`, `id`, `version`, `deleted`, `creator`, `creator_name`, `create_date`, `update_by`, `update_by_name`, `update_date`, `defn_value4`, `defn_value5`, `defn_value6`, `defn_value7`, `defn_value8`, `defn_value9`, `defn_value10`) VALUES ('WORK_HANDOVER_GRAY_LIST', 'å·¥ä½œäº¤æ¥æµç¨‹ç°åº¦é…ç½®', 'dept_200000', '', '', '', 13596, 1, 0, NULL, NULL, '2025-12-17 15:47:48', NULL, NULL, '2025-12-17 15:47:48', '', '', '', '', '', '', '');
INSERT INTO `corehrpt_common`.`t_com_defn_cfg_dtl` (`defn_id`, `descr`, `defn_key`, `defn_value1`, `defn_value2`, `defn_value3`, `id`, `version`, `deleted`, `creator`, `creator_name`, `create_date`, `update_by`, `update_by_name`, `update_date`, `defn_value4`, `defn_value5`, `defn_value6`, `defn_value7`, `defn_value8`, `defn_value9`, `defn_value10`) VALUES ('WORK_HANDOVER_GRAY_LIST', 'å·¥ä½œäº¤æ¥æµç¨‹ç°åº¦é…ç½®', 'dept_200000', ' ', ' ', ' ', 13605, 0, 0, NULL, NULL, NULL, NULL, NULL, NULL, ' ', ' ', ' ', ' ', ' ', ' ', ' ');