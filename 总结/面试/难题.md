### 周年庆
1. SVG转PNG的性能与兼容性问题
问题：
最初使用 Apache Batik，存在性能瓶颈
不同业务单位需要不同尺寸（OPP10 为 1/2，RM01 为 3 倍），需要动态调整
解决方案：
迁移到 JSVG，提升性能
根据业务单位动态计算目标尺寸，避免固定缩放
2. 中文字体渲染问题
问题：
SVG 中的中文字体在转 PNG 时可能无法正确渲染
不同环境字体缺失导致显示异常
解决方案：
实现字体注册机制，优先加载项目字体（如 OPPOSans），失败则回退到系统字体
在 SVG 转换前替换 font-family，确保使用已注册字体
3. 批量图片生成的性能瓶颈
问题：
每个员工需生成 4 种屏幕类型（Web、Mobile、Pad、Fold）
每个图片需：下载 SVG → 替换变量 → 转 PNG → 上传文件
串行处理导致耗时过长
解决方案：
考虑异步或并行处理（线程池/CompletableFuture）
对已生成的图片做缓存，避免重复生成

### HR看板-多元化用工-人员流动
1. 多元化用工类型的数据源复杂性
问题：
不同用工类型需要查询不同的数据源：
- 人力外包（非RO）：仅查询 OMS 数据
- 顾问：仅查询 OMS 数据
- 研发类项目外包：需要合并查询 OMS + CoreHR 数据（使用内存分页）
- 其他类型：仅查询 CoreHR 数据
数据格式和接口不一致，需要统一处理
解决方案：
根据用工类型动态选择数据源和查询策略
实现统一的数据转换层，将不同数据源的结果转换为统一格式
对于需要合并查询的场景，使用内存分页处理

2. 用工类型编码转换问题
问题：
系统内部用工类型编码与雅典娜（数据仓库）的员工类型编码不一致
需要建立映射关系进行转换
转换失败可能导致数据查询错误
解决方案：
使用枚举类 `DiversifiedEmplClassEnum` 维护编码映射关系
提供 `getOmcCodeByCode()` 方法进行编码转换
增加空值检查，避免转换失败导致异常

3. 异步并发场景下的线程上下文丢失
问题：
使用 `CompletableFuture` 进行并行查询时，`UserContextHolder` 中的用户信息会丢失
导致权限检查失败，查询返回 null
解决方案：
在创建异步任务前，手动从 `UserContextHolder` 获取用户信息
将用户信息设置到查询对象的 `oprId` 字段
在异步任务中使用查询对象中的 `oprId` 进行权限检查

4. 多数据源并行查询的性能优化
问题：
一个接口需要查询多个数据源：
- 4 种在途类型（入职、调入、离职、调出）的人数统计
- 雅典娜的历史完成数据
- 当月、下月、下下月的预估数据
串行查询会导致响应时间过长（可能超过 3 秒）
解决方案：
使用 `CompletableFuture` 并行执行所有 RPC 调用
使用线程池 `ThreadPoolTaskExecutor` 控制并发数量
通过 `CompletableFuture.allOf().join()` 等待所有任务完成
将查询对象进行深拷贝，避免共享变量导致的并发问题

5. 预估数据计算的业务逻辑复杂性
问题：
需要计算当月和下两个月的预估在职人数
计算公式：基础在职人数 + 人员变动（入职+调入-离职-调出）
需要从多个数据源获取数据并合并计算
不同月份的预估逻辑略有差异
解决方案：
抽取 `calculateEstimatedData()` 方法统一处理预估逻辑
分别计算当月、下月、下下月的基础数据和变动数据
使用 Map 结构存储按月份分组的数据，便于后续排序和展示

6. 核心事项数据采集的分用工类型查询
问题：
多元化用工的人员流动需要按用工类型分别查询
每个用工类型都需要调用一次数据采集服务
如果用工类型较多，会导致查询次数成倍增加
解决方案：
遍历所有配置的用工类型，为每个类型创建独立的查询对象副本
使用 `BeanUtils.copyProperties()` 避免对象共享问题
对每个用工类型分别调用 `issueCollectData()` 方法
将结果合并到 `issueDataDtoList` 中统一入库

7. 数据导出时的多次查询问题
问题：
导出功能需要分别查询 4 种在途类型的数据
每次查询都需要修改查询对象的 `pendingType` 字段
如果数据量大，查询时间会很长
解决方案：
使用 `Long.MAX_VALUE` 作为分页大小，一次性获取所有数据
对每种类型分别查询，避免数据混淆
使用异步导出 `ExportHelper.asyncBatchExportExcel()` 避免阻塞主线程


### 做了哪些功能、
面试官你好，我是来自HR产品组的项文杰有一年以上的工作经验，参与了核心人事系统的开发，这是一个企业的内部管理系统，主要面对HR和管理者，包括人事、组织、薪酬、考勤等模块，这个系统使用到的技术栈包括Spring Boot、	Spring Cloud、MyBatis、MySQL 、Redis、RocketMQ等；这个系统是个微服务的架构包含多个服务比如basic、common提供基础能力和公共能力，workflow用于工作流审批相关，pers用于入职合同等。我主要负责人事组织相关的模块开发。
# HR看板-多元化用工-人员流动
# 团队看板
当前的核心人事系统缺少人力大盘、人员流动、干部管理、关键员工等方面的数据指标，无法系统性的展现人员的流动、干部编制职级考勤等信息、在数据分析维度上较为单一，无法提供数据分析。
人员流动是 HR 组织看板下的子模块，主要做组织维度的人员进出与在途统计，支持正式员工和多元化用工两类人群，用于管理层掌握“当月新增/减少、入离职、调动、历史趋势和预估”。
多元化用工包括人力外包、顾问、叶子、劳务派遣；员工历史数据是通过大数据提供的接口获取，我们系统主要处理在途的数据（也就是入职离职调动还未完成的数据）
不同用工类型需要查询不同的数据源、外包员工的数据存在外包管理系统中，当时采取的策略是通过定时任务全量同步，每天拉取在途的数据，因为对时效性要求不高拉取的是t+1的数据，而且要对拉取的数据进行额外的操作，
对于其他的数据则直接从本系统查询
难点在于多个系统进行对齐和联调，以及要理解本系统各个模块的逻辑，还有不同主体之间的组织映射不是一一对应的，需要额外增加对应的组织映射表要和已有的组织权限表联动


高管助理
人事数据提取
灰度能力提供
# 周年庆通知

员工入职日期周年当天，早上9点，定时任务触发TT通知；入职当天不触发，入职满1周年及之后周年才触发。
根据员工入职周年推送对应海报和文案,
方案：在发送海报的前一天晚上执行定时任务提前生成不同员工对应的海报图片用于第二天发送，使用svg文件的形式
我才用的是svg的方案来实现，因为通过坐标来替换名字和工号，对于不同周年的海报需要都实现一套相似的逻辑，而svg的本质是标签可以通过替换文本来实现定制化的操作。
1. 问题：
最初使用 Apache Batik，存在性能瓶颈，且有兼容性问题，只支持标准格式的svg文件转换         
解决方案：
迁移到 JSVG，提升性能
根据业务单位动态计算目标尺寸，避免固定缩放
2. 中文字体渲染问题
问题：
SVG 中的中文字体在转 PNG 时可能无法正确渲染
不同环境字体缺失导致显示异常
解决方案：
实现字体注册机制，优先加载项目字体（如 OPPOSans），失败则回退到系统字体
在 SVG 转换前替换 font-family，确保使用已注册字体

发送消息通知（离职、入职）
回流限制
人力规划
考情冻结、关账、补签增加校验
岗位称重
批量离职

# 性能优化
改成右模糊查询、去掉分页操作（count和page分别执行一遍）、查询数量是不需要查询多余的字段、增加索引、
获取团队异动明细:
主要问题：
1、getTransferList串行3次调用，仅需count且存在慢sql，想办法合并
2、优化PS接口C_PT_OUTBOUND_PRTL_ASSN.v1
3、getTerminationCnt慢sql     
4、PS接口与优化后的getTransferList并行
### 优化
（去除日期上的函数操作、将子查询改成join查询、去除重复条件）
（把 OR 条件拆成多段 UNION ALL、(A OR B) 常导致优化器难以用好索引，容易变成全表/大范围扫描。
拆成多段后，每段是「单列等值」（如 business_unit_from = 'OPP10' 或 business_unit_to = 'OPP10'），更容易走索引（如 idx_business_unit_from、idx_business_unit_to），再 UNION ALL 合并结果。）

获取FAQ答案详情:
主要问题：
调用了两次机器人的sdk，每次都250ms以上，两次参数是不同的，所以必须有两次调用。 
方案： （1）两次调用由串行改成并行 
（2）定时预热缓存，从缓存获取结果（推荐）

主要问题：
语句为分页查询，count 和 page 分别执行一遍，且 SQL 性能不高，like全模糊匹配不走索引。
解决方案：
1.去掉分页操作，直接返回列表（前端不需要分页）；
2.判断是否完整工号，如果是的话直接走匹配查询，不用 like；（解决大部分情况）
3.或者直接改用左匹配。

# aisphere应用开发
补签助手、加班助手