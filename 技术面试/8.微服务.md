## 1.SpringCloud的五大核心组件
Spring Cloud五大组件是：

1.注册中心：Eureka 

2.负载均衡：Ribbon

3.远程调用：Feign 

4.服务熔断：Hystrix 

5.网关：Zuul 

SpringCloudAlibba：

1.注册中心/配置中心 Nacos

2.负载均衡 Ribbon

3.服务调用 Feign

4.服务保护 Sentinel（英/ˈsentɪnl/）

5.服务网关 Gateway

## 2.nacos与eureka的区别？
<!-- 这是一张图片，ocr 内容为：USER-SERVICE: LOCALHOST:8081 EUREKA-SERVER LOCALHOST:8082 注册中心 LOCALHOST:8083 ORDER-SERVICE: LOCALHOST:8080 2)拉取服务 1)注册服务信息 USER-SERVICE的信息 心跳续约,每30秒1次 ORDER-SERVICE USER-SERVICE 8080 8082 远程调用 3)负载均衡 LOCALHOST:8081 服务提供者 服务消费者 -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1689574584477-17590a59-3a5a-4b5f-97d1-31651e5139d7.png)

<!-- 这是一张图片，ocr 内容为：NACOS: DISCOVERY: SERVER-ADDR: 192.168. NACOS EPHEMERAL: FALSE # 注册中心 定时拉取 服务PULL 注册服务信息 临时实例 非临时实例 采用心跳监测 主动推送 NACOS主动询问 变更消息 PUSH 服务消费者 服务提供者 远程调用 -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1689574602295-119cde0c-f92b-4644-af1e-0efce2649a81.png)

共同点：

① 都支持服务注册和服务拉取

② 都支持服务提供者心跳方式做健康检测

不同点：

1.Nacos支持服务端主动检测提供者状态，临时实例采用心跳模式，非临时实例采用主动检测模式，临时实例心跳不正常会被剔除，非临时实例则不会被剔除

2.Nacos支持配置中心，而eureka只有注册中心

3.Nacos支持服务列表变更的消息推送模式，服务列表更新更及时

4.Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式

## 3.负载均衡如何实现的 ? 
我们在使用feign远程调用的过程中，底层的负载均衡就是使用了ribbon。

<!-- 这是一张图片，ocr 内容为：注册中心 3.返回服务列表 2.拉取 LOCALHOST:8081 USERSERVICE LOCLAHOST:8082 USER-SERVICE 8081 RIBBON ORDER-SERVICE 4.轮询到8081 负载均衡 1.发起请求 HTTP://USERSERVICE/USER/1 USER-SERVICE LLLILLI. 8082 -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1689575383568-2658ea83-c1f7-404b-8a1f-ca45ec495f4c.png)

## 4.负载均衡策略有哪些 ?
1.RoundRobinRule：简单轮询服务列表

2.WeightedResponseTimeRule：按照权重来选择服务器，响应时间越长，权重越小

3.RandomRule：随机选择一个可用的服务器

4.ZoneAvoidanceRule：以区域可用的服务器为基础进行服务器的选择。

## 6.什么是服务雪崩
服务雪崩：是指一个服务失败，导致整条链路的服务都失败的情形。

服务降级：保护下游服务的一种方式，确保服务不会崩溃，一般与feign接口整合，编写降级逻辑。

<!-- 这是一张图片，ocr 内容为："LEADNEWS-ARTICLE",FALLBACK - IARTICLECLIENTFALLBACK.CLASS) @FEIGNCLIENT(VALUE PUBLIC INTERFACE IARTICLECLIENT 您的网络有问题,请稍后再试 服务 @POSTMAPPING("/API/V1/ARTICLE/SAVE") T SAVEARTICLE(@REQUESTBODY ARTICLEDTO DTO); PUBLIC RESPONSERESULT SAVEA @COMPONENT 降级 服务 服务A  PUBLIC CLASS JARTICLECLIENTFALLBACK IMPLEMENTS IARTICLECLIENT { @OVERRIDE PUBLIC RESPONSERESULT SAVEARTICLE(ARTICLEDTO DTO) ( N RESPONSERESULT.ERRORRESULT(APPHTTPCODEENUM.SERVERROR,"获取数据失败"); RETURN R 子 如果降级太多,则会触发熔断机制 服务 LAPI/Y1/ARTICLE/SAVE -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1689575928036-6c08319c-0d8e-4e5c-bdc5-ad74c140745a.png)

服务熔断：默认关闭，需要手动打开，如果检测到 10 秒内请求的失败率超过 50%，就触发熔断机制。之后每隔 5 秒重新尝试请求微服务，如果微服务不能响应，继续走熔断机制。如果微服务可达，则关闭熔断机制，恢复正常请求。

Hystrix 熔断机制，用于监控微服务调用情况， 默认是关闭的，如果需要开启需要在引导类上添加注解：@EnableCircuitBreaker。

## 7.限流
限流方式：

nginx漏桶算法，网关令牌桶算法。

限流算法：

漏桶算法：把请求存入到桶中，以固定速率从桶中流出，可以让我们的服务做到绝对的平均，起到很好的限流效果。

令牌桶算法：在桶中存储的是令牌，按照一定的速率生成令牌，每个请求都要先申请令牌，申请到令牌以后才能正常请求。

<!-- 这是一张图片，ocr 内容为：LITER 固定速率生成令牌,存入令牌 桶,桶满后暂停生成 水滴代表请求的流量 令牌桶 申请到令牌的请求才 请求需要到令牌桶申请令牌 漏桶存储请求 多余请求等待或抛弃 会被服务处理 没有令牌的请求,会 漏桶以固定速率漏出请求 被阻塞或丢弃 见,使用SPEL表达式获取 -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1689576974135-05c1c880-086b-4ef2-8a04-1e2166af62ab.png)

## 8.CAP
在分布式系统中，三者无法同时满足，最多只能同时满足其中的两个。

1.一致性(Consistency)是指更新操作成功并返回客户端完成后，所有节点在同一时间的数据完全一致(强一致性)，不能存在中间状态。

2.可用性(Availability) 是指系统提供的服务必须一直处于可用的状态，对于用户的每一个操作请求总是能够在有限的时间内返回结果。

3.分区容错性(Partition tolerance) 是指分布式系统在遇到任何网络分区故障时，仍然需要能够保证对外提供满足一致性和可用性的服务，除非是整个网络环境都发生了故障。

## 9.BASE
BASE理论是对CAP定理的一种补充，它强调在分布式系统中，一致性可能会受到一定程度的放松，以换取更好的可用性和性能。

1.Basically Available（基本可用）：分布式系统在出现故障时，允许损失部分可用性，即保证核心可用。

2.Soft state（软状态）：在一定时间内，允许出现中间状态，比如临时的不一致状态。

3.Eventually consistent（最终一致性）：虽然无法保证强一致性，但是在软状态结束后，最终达到数据一致。

## 10.接口幂等性
幂等: 多次调用方法或者接口不会改变业务状态，可以保证重复调用的结果和单次调用的结果一致

如果是新增数据，可以使用数据库的唯一索引

如果是新增或修改数据

1.分布式锁，性能较低

2.使用token+redis来实现，性能较好

第一次请求，生成一个唯一token存入redis，返回给前端

第二次请求，业务处理时携带之前的token，到redis进行验证，如果存在，可以执行业务，删除token；如果不存在，则直接返回，不处理业务。

<!-- 这是一张图片，ocr 内容为：商品 推荐 详情 评价 创建商品,提交订单,转账,支付等操作 华为MATE50 新品上市手机,唯金黑[碑... 华为MATE50 手机华为 MATE50 安全第[印房险客装]2560全网络 京东秒杀! 4799 十 *5289.00 R 现象当天发 预估到手 京东价￥5289.00 还到2天10:46:15 每件到手价V4799.00 直持7天无毒色退货(激试回不左持)7天的保 直控中皮车 解关 阻金瓜(昆仑玻璃) [甜品][京东仓]充电仓再无线蓝牙耳机(图供仅供参考) 服务端 客户端 REDIS [赠品][京东仓]太空人宇航员解顾手机支架(图片仅供参考) 金色 官方标配 [甜品][京东仓]更满式显牙音响(图片仅供参考]绿色陆桂) 以旧换新 [赠品]体验卡免费领,导款APP免说,超大质量任性用,点出就放 白条字6期免息.每期约881.5元(每日约29.38元) 第一次请求 领养0 立减10 立减2 1.获取TOKEN 服务 可选增值服务 首购礼金 ￥300 配送 快递运输 2.生成唯一TOKEN 工作日,双体日与节假日均可送货 元续费PLUS年卡预估此单额外省46464元 退换货免运费 商家赠送 将TOKEN存储到REDIS中 享运费补贴或免费取件服务 3.返回TOKEN 华为MATE50新品上市手机曜金黑[碎 屏险套装]256G全网通 留言 建议曾言前先与商家沟通确认 晓龙高端防水手机热卖榜第4名 全排行榜 区分享 合收藏 商品金额 ￥5289.00 第二次请求 1.带TOKEN请求业务接口 退换货免运费 ￥0.00 2.验证TOKEN是否存在 已选:曜金黑,[碎屏险套装]256G全网 选择已 ￥0.00 通,1件,可选服务 -V190.00 立减 3.存在则处理业务(删除TOKEN), 规格 6.7英寸 骁龙8+G. OLED直屏 PK 礼金 屏幕尺寸 屏幕材质类型 不存在返回 4.返回请求结果 无可用 优惠券 限时促销:商品限时9折优惠,现在下单立省490元 以旧换新( 旺~旺 ￥4799.00 加入购物车 提交订单 ￥4799 脂肪 带TOKEN验证 生成TOKEN -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1690619911269-09fc9e22-771d-4cc4-a0f2-966deec85b66.png)

## 11.xxl-job路由策略有哪些？
轮询、随机、故障转移、分片广播

## 12.xxl-job任务执行失败怎么解决？
1.路由策略选择故障转移，优先使用健康的实例来执行任务

2.在创建任务时，可以设置重试次数

## 13大数据量的任务同时都需要执行
路由策略设置为分片广播，部署多个实例，共同去执行这些批量的任务，在任务执行的代码中可以获取分片总数和当前分片，按照取模的方式分摊到各个实例执行就可以了。

## 0——————————————————————————————
## 1.RabbitMQ如何保证消息不丢失
<!-- 这是一张图片，ocr 内容为：CONSUMER1 QUEUE1 消息未到达交换机 PUBLISHER 消息未到达队列 EXCHANGE 消费者未接收到消息 QUEUE2 CONSUMER2 队列中消息丢失 -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1690621742273-534a9a8e-d6a0-492c-9660-81bd744f0904.png)

1.开启生产者确认机制，确保生产者的消息能到达队列。

2.开启持久化功能，确保消息未消费前在队列中不会丢失，其中的交换机、队列、和消息都要做持久化。

3.死信队列： 为无法成功消费的消息设置死信队列，这些消息可以被放置在特定的队列中，方便后续检查和处理。

4.设置一定的重试次数。

## 2.重复消费问题
1.每条消息设置一个唯一的标识id

2.分布式锁、数据库锁（悲观锁、乐观锁）

## 3.死信交换机
延迟队列就是用到了死信交换机和TTL（消息存活时间）实现的。

死信交换机：

如果消息超时未消费就会变成死信，在MQ中如果消息成为死信，队列可以绑定一个死信交换机，在死信交换机上可以绑定其他队列，在我们发消息的时候可以按照需求指定TTL的时间，这样就实现了延迟队列的功能了。

<!-- 这是一张图片，ocr 内容为：REJECT SIMPLE.QUEUE PUBLISHER CONSUMER SIMPLE.DIRECT DEAD-LETTER-EXCHANGEDL.DIRECT DEAD-LETTER-ROUTING-KEYDL IP DL.QUEUE DL.DIRECT -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1690632004754-03de4382-8d54-4d85-83e2-fac90cbb5ec0.png)

TTL：

TTL也就是Time-To-Live。如果一个队列中的消息TTL结束仍未消费，则会变为死信，ttl超时分为两种情况：

• 消息所在的队列设置了存活时间

• 消息本身设置了存活时间

## 4. RabbitMQ 延迟队列实现：
在RabbitMQ中，可以通过以下步骤实现延迟队列：

1.创建一个普通的消息队列，用于存放需要延迟处理的消息。

2.创建一个专门的交换机（Exchange）和队列，用于存放延迟过期的消息。

3.将这个队列绑定到交换机，并设置消息的过期时间。

4.生产者将需要延迟处理的消息发送到普通队列中，消息会在普通队列中等待一定时间后过期并被转发到延迟队列，然后再由消费者进行处理。

## 5.消息堆积
1.增加更多消费者，提高消费速度

2.在消费者内开启线程池加快消息处理速度

3.采用惰性队列

基于磁盘存储，消息上限高

性能比较稳定，但基于磁盘存储，受限于磁盘IO，时效性会降低

## 6.MQ的基本类型有哪些
<!-- 这是一张图片，ocr 内容为：WORK QUEUES 基本消息队列(BASICQUEUE) "HELLOWORLD! DISTRIBUTING TASKS AMONG THE SIMPLEST THING THAT DOES WORKERS (THE COMPETING 工作消息队列(WORKQUEUE) CONSUMERS PATTERN) SOMETHING 发布订阅(PUBLISH,SUBSCRIBE),又根据交换机类型不同分为三种: FANOUT EXCHANGE:广播 PUBLISH/SUBSCRIBE DIRECT EXCHANGE:路由 TOPIC EXCHANGE:主题 SENDING MESSAGES TO MANY CONSUMERS AT ONCE ROUTING RECEIVING MESSAGES SELECTIVELY 5 TEPICS RECEIVING MESSAGES BASED ON A PATTERN (TOPICS) -->
![](https://cdn.nlark.com/yuque/0/2023/png/34358440/1694086151653-1af9e2bb-94e7-4db7-be44-30389c8bcc39.png)

Exchange（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！

